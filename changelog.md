# список изменений

> Здесь указаны не все изменения, а только самые важные.
> За подробными изменениями рекомендую обратиться к деталям commit-а.

## Следующая версия

- Если авторизация произведена через аккаунт родителя - предоставлять данные по нескольким детям.
- **Дз на завтра** (с регулировкой времени рассылки).
- **Запустить проект**.


## 11.02.2025

- Исправлена команда `/i_marks`.
- Немного поднято качество кода.
- Исправлены умные уведомления.
- Исправлен демо-режим.


## 24.01.2025

- Исправлен и настроен модуль работы с уведомлениями.
- Исправлена команда `/notify`.
- Исправлена работа кнопок `/hw` -> "Дни недели".


## 23.01.2025

- Исправлена работа команды `/new`.
- Исправлена ошибка связанная с тегом `<span>`.

```
# TODO @iamlostshe: Иногда в ответе проскальзывает html,
# в связи с этим происходит ошибка:
# Tag "span" must have class "tg-spoiler"
# "<span style="background-color: rgb(244, 244, 244);">§82,85 стр.274 №5-7</span>"
```


## 21.01.2025

- Добавлена возможность установки зависимостей через `poetry`.


## 17.01.2025

- Код приведён к более стандартному виду.
- Добавлен конфиг для линтера `ruff`.


## 13.01.2025

- **Переработана регистрация** в боте.
- Добавлена возможность работать со всеми серверами барса **во всех регионах**.


## 20.11.2024

- Подключены обработчики ошибок.
- Добавлены счётчики для аналитики.
- Исправлен баги связанные с `/chatgpt`.
- Реализованы **умные уведомления**.


## 11.11.2024

- Теперь все соответствует стандарту PEP-8.
- Проверена орфография.

## 30.10.2024

- Переписан модуль для работы с дз.
- Сделана **демо-версия**: нужна для презентации работает так: `/new demo`.


## 29.10.2024

- Переписан и типизирован модуль `notify.py`: положено начало `умным уведомлениям`, дописаны до конца **уведомления о изменении оценки**
- `/notify`: Доработан интерфейс включения/отключения уведомлений


## 28.10.2024

- Исправлена `/admin`.
- `/about`: Добавлена команда с описанием проекта.
- Изменен `pars.py` (`import json` -> `r.json()`).
- Решены проблемы с зависимостями при загрузке данных из `.env`.


## 24.10.2024

- Исправлены ошибка регистрация.
- Добавлены планы на будущее (**\# TODO**).


## 29.09.2024

- Все *модули* (вспомогательные) теперь в папке `utils`.
- Все *обработчики* перенесены из `bot.py` в папку `handlers`.
- Все *исключения* теперь в модуле `utils.exception` (созданы новые и централизованы старые).
- Добавлена обработка **пустых** ответов сервера (`Оценок пока нет`, `На этот день нет домашнего задания`).
- Переписан и типизирован модуль для работы с домашним заданием `hw.py` (из важного: удалено **воскресенье**).
- Переписана функция `request` в модуле `pars` (теперь принимает **id пользователя** или **cookie**).


## 28.08.2024

- Изменена система использования *секретных данных* (*токен*, *id админов*) (`config.py` -> `.env`).

- Переписана база данных:
    - **Типизация**.
    - Обработка **ошибок**.
    - Обращение теперь строится через id пользователя в тг, а не перебором по списку из всех id пользователей.
    - Написаны 2 новые функции для **админки** => **Доделана админка**:
        - Построение *графика зависимости прироста аудитории бота от времени*.
        - Получение данных об общем количестве пользователей в боте и списке способов прихода аудитории в порядке от наибольшего прихода к наименьшему. => **Разработана реферальная система для анализа источников прихода аудитории**
    - Написаны 2 функции для управления **уведомлениями**:
        - *Получение текущего состояния уведомлений* (включены или выключены, True или False).
        - *Изменение текущего состояния уведомлений на противоположное* (**`вкл`** -> **`выкл`** | **`выкл`** -> **`вкл`**)

- Изменен **API** для использования **GPT** (если раньше это была библиотека [g4f](https://pypi.org/project/g4f/), то теперь мы просто используем [API hugging face](https://huggingface.co/spaces/gokaygokay/Gemma-2-llamacpp) модели с открытым исходным кодом).
- Переписан модуль для парсера (теперь функция для запроса лишь одна):
    - Изменены **имена** функции для получения информации о днях рождения (`birtdays` -> `birthdays`).
    - Более красивый вид.
    - Разбит на функции.
    - **Типизация**.

- Добавлен модуль с *сообщениями* - **messages.py** (это что-то вроде конфига, в котором можно быстро поправить какое-либо сообщение).
- Написаны *тесты* для **pars.py**, **db.py**.
- Добавлена папка **docs**, в которой будут находиться наработки для текста *исследовательский* работы в формате `.md`, совместимым с **Obsidian**-ом.
- Добавлено логирование с помощью модуля **loguru**.


## 03.05.2024

- **Алгоритм работы с json базой данных данных** (для *записи* и дальнейшего *использования* cookie пользователей) (команды: `/new` и `/del`).
- **Приветственное сообщение** (команды `/start` и `/help`).
- **Просмотр оценок за текущую четверть** (команда `/marks`).
- **Просмотр итоговых оценок** (команда `/i_marks`).
- **Просмотр информации о днях рождения** (команда `/birthdays`).
- **Данные о событиях** (так и не разобрался за что отвечает этот раздел API).
- **Просмотр информации о классных часах** (дата, время, кабинет проведения, тема классного часа) (команда `/ch`).
- **Просмотр данных о пользователе** (ФИО, дата рождения, школа, класс, номер телефона родителя (если доступен)) (команда `/me`).
- **Реализован просмотр домашнего задания** (на завтра, на неделю, по определенному дню недели) (команда `/hw`).
- **Алгоритм автоматического решения дз** (*chatgpt*, и если хочется по старинке *google*) (сомневаюсь что понравится комиссии, но всегда можно ограничить функционал) (команды: `/chatgpt` и доступ через кнопки при просмотре дз)
